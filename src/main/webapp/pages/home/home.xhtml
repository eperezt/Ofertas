<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <h:outputStylesheet name="default.css" library="css" />
        <h:outputStylesheet name="login.css" library="css" />
    </h:head>
    <h:body>
        <div class="header">
            <h2>OFERTAS RETAIL</h2>
        </div>
        <h:form>
            <p:growl id="messages" showDetail="false"/>
            <p:menubar>
                <f:facet name="user">
                    <h:outputLabel value="Bienvenido"/>
                </f:facet>
                <f:facet name="options">
                    <c:if test="${loginBean.usuarioSesionado.consumidor != null}">
                        <h:outputText value="Bienvenido! : ${loginBean.usuarioSesionado.consumidor.nombre.trim()} ${loginBean.usuarioSesionado.consumidor.apellidopaterno.trim()}    "/>
                    </c:if>
                    <c:if test="${loginBean.usuarioSesionado.trabajador != null}">
                        <h:outputText value="Bienvenido! : ${loginBean.usuarioSesionado.trabajador.nombre.trim()} ${loginBean.usuarioSesionado.trabajador.apellidopaterno.trim()}    "/>
                    </c:if>
                    <p:commandButton value="Cerrar Sesion" icon="ui-icon-extlink" action="#{loginBean.logoutListener}" />
                </f:facet>
            </p:menubar>
        </h:form>
        <p:layout style="min-width:400px;min-height:800px;">
            <p:layoutUnit position="west" resizable="false" size="210" minSize="200" maxSize="350">
                <h:form>  
                    <p:growl id="messages" showDetail="false"/>
                    <h2 style="margin-top:20">Menu</h2>
                    <p:menu>
                        <p:menuitem value="Lista de ofertas" action="#{homeBean.cambiarPagina('/pages/home/home')}"/>
                        <p:menuitem value="Tus Puntos" action="#{homeBean.cambiarPagina('/pages/consumidor/puntos')}"/>
                        <p:menuitem value="Cupón de descuento" action="#{homeBean.cambiarPagina('/pages/consumidor/cuponDescuento')}"/>
                    </p:menu>
                </h:form>
            </p:layoutUnit>
            <p:layoutUnit position="center">
                <div class="titulo">
                    <h2>¡Elije tu Oferta!</h2>
                </div>
                <div class="container">
                    <h:form>
                        <p:panel id="panel" header="Filtrar ofertas" style="margin-bottom:10px;">
                            <p:messages id="messages" />
                            <h:panelGrid columns="7" cellpadding="5">
                                <h:outputLabel for="somEmpresas" value="Empresa:" />
                                <h:selectOneMenu id="somEmpresas" value = "#{homeBean.empresaSeleccionada}"> 
                                    <f:selectItem itemLabel="Todas" itemValue=""/>
                                    <f:selectItems value="#{homeBean.listaEmpresas}"/>                        
                                </h:selectOneMenu> 

                                <h:outputLabel for="somRubros" value="Categoría:" />
                                <h:selectOneMenu id="somRubros" value = "#{homeBean.rubroSeleccionado}"> 
                                    <f:selectItem itemLabel="Todos" itemValue=""/>
                                    <f:selectItems value="#{homeBean.listaRubros}"/>                        
                                </h:selectOneMenu> 

                                <h:outputLabel for="producto" value="Producto:" />
                                <p:inputText value="#{homeBean.filtro}">
                                    <p:ajax event="keyup" update="grid" listener="#{homeBean.filterList()}" />
                                </p:inputText>
                                <p:commandButton value="Filtrar" update="grid" actionListener="#{homeBean.filterList()}"/>
                            </h:panelGrid>
                        </p:panel>
                    </h:form>
                </div>
                <p:dataGrid id="grid" var="oferta" value="#{homeBean.listaOfertasFiltradas}" columns="3" layout="grid"
                            rows="4" paginator="true" style="margin-top:20px" emptyMessage="No existen Ofertas para listar.">
                    <f:facet name="header">
                        Ofertas
                    </f:facet>

                    <p:panel header="#{oferta.productoIdproducto.nombre}" style="text-align:center">
                        <h:panelGrid columns="1" style="width:100%" onclick="PF('dlgValoracion').show();">
                            <p:graphicImage value="#{imageStreamer.image}">
                                <f:param name="id" value="#{oferta.idoferta}" />
                            </p:graphicImage>
                            <h:outputText value="Hasta el #{oferta.fechafin}" />
                            <h:outputText value="Desde #{oferta.minimoproductos} a máx. #{oferta.maximoproductos} unidades" />
                            <h:outputText value="Precio normal: #{oferta.productoIdproducto.precio}" />
                            <h:outputText value="Precio oferta: #{homeBean.calcularPrecioOferta(oferta.productoIdproducto.precio, oferta.productoIdproducto.descuento.isporcentaje, oferta.productoIdproducto.descuento.ispreciodirecto, oferta.productoIdproducto.descuento.porcentajedescuento, oferta.productoIdproducto.descuento.preciodescuento)}" />
                        </h:panelGrid>
                    </p:panel>
                </p:dataGrid>
            </p:layoutUnit>
        </p:layout>       
        <p:dialog 
            widgetVar="dlgValoracion" modal="true" 
            width="25%" height="80%" 
            closeOnEscape="true" maximizable="false" minimizable="false" resizable="false"
            style="text-align: center">
            <h:form>
                <p:growl id="growl" sticky="true" showDetail="false" life="3000"/>
                <h:outputText value="¡Valora tu oferta, consigue puntos y obtén cupones de descuento cada mes!" style="text-align: center; font-weight: bold;font-size: 24px"/>
                <br/>
                <br/>
                <h:outputText value="Tan solo sigue los pasos indicados abajo." style="text-align: center;font-size: 14px"/>
                <br/>
                <br/>
                <h:outputText value="Sube una imagen de tu boleta" style="font-weight: bold;font-size: 14px"/>
                <br/>
                <h:form enctype="multipart/form-data">
                    <p:growl id="messages" showDetail="true" />
                    <p:fileUpload value="#{homeBean.file}" mode="simple" skinSimple="true" fileLimit="1" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" sizeLimit="2000000" label="Selecciona un archivo..."/>
                </h:form>
                <br/>
                <h:outputText value="¡Valoriza esta oferta!" style="font-size: 14px"/>
                <br/>
                <br/>
                <h:form>
                    <p:growl id="messages" showDetail="true"/>
                    <p:rating value="#{homeBean.rating}" stars="3" cancel="false" style="height: 2vh">
                        <p:ajax event="rate" listener="#{homeBean.onrate}" update="messages" />
                    </p:rating>
                    <h:panelGrid columns="2" cellpadding="5">

                    </h:panelGrid>
                </h:form>
                <br/>
                <br/>
                <h:outputText value="¿Quieres saber cómo funciona?" style="text-align: center;font-size: 14px"/>
                <br/>
                <br/>
                <h:outputText value="Haz click aquí" style="text-align: center;font-size: 14px"/>
                <br/>
                <br/>


                <p:commandButton value="Cancelar" type="button" onclick="PF('dlgValoracion').hide();" id="btnCancelarValoracion"/>
                <p:commandButton value="¡Valoriza!" id="btnAceptarValoracion" update="growl" actionListener="#{homeBean.valorizar(oferta)}" styleClass="ui-priority-primary" />
            </h:form>
        </p:dialog>
        <div class="footer"></div>
    </h:body>
</html>
